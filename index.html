<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìš”ì–‘í•©ê²© CBT</title>
    <style>
        :root { --cbt-dark: #2c3e50; --cbt-blue: #34495e; --bg: #f4f7f9; --wrong-gray: #e9ecef; --done-gray: #bdc3c7; }
        body { font-family: 'Malgun Gothic', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }

        .cbt-header { 
            background: var(--cbt-dark); color: white; padding: 10px 15px; 
            display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100;
        }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .home-icon { width: 24px; height: 24px; cursor: pointer; fill: white; display: flex; align-items: center; }
        .font-controls { display: flex; align-items: center; gap: 8px; background: #444; padding: 4px 10px; border-radius: 20px; color: white; font-size: 0.9rem; }
        .font-btn { background: white; border: none; width: 28px; height: 28px; border-radius: 50%; font-weight: bold; cursor: pointer; color: black; }
        
        .home-container { padding: 20px; text-align: center; max-width: 500px; margin: 0 auto; padding-bottom: 100px; }
        .section-title { text-align: left; font-size: 1.1rem; font-weight: bold; color: var(--cbt-dark); margin: 20px 0 10px 5px; border-left: 4px solid #007bff; padding-left: 10px; }
        .menu-btn { width: 100%; padding: 18px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 12px; background: white; font-size: 1.1rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .sub-menu { display: none; background: #e9ecef; border-radius: 12px; padding: 10px; margin-bottom: 15px; }
        .sub-btn { width: 100%; padding: 14px; margin: 5px 0; border: none; border-radius: 8px; background: #dae4f1; font-size: 1rem; cursor: pointer; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .sub-btn.completed { background: var(--done-gray); color: #666; }

        .progress-section { padding: 15px 20px; background: white; border-bottom: 1px solid #eee; }
        .progress-container { width: 100%; background: #eee; height: 12px; border-radius: 6px; overflow: hidden; }
        .progress-bar { width: 0%; height: 100%; background: #4caf50; transition: width 0.3s; }
        .quiz-container { padding: 20px; max-width: 800px; margin: 0 auto; position: relative; min-height: 400px; }
        #circle-mark { display: none; position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 200px; height: 200px; border: 15px solid rgba(255, 0, 0, 0.2); border-radius: 50%; z-index: 999; pointer-events: none; }
        .opt-box { display: block; width: 100%; padding: 15px; margin-bottom: 10px; border: 1px solid #eee; border-radius: 8px; background: white; text-align: left; font-size: inherit; cursor: pointer; position: relative; z-index: 10; line-height: 1.4; }
        .opt-box.wrong { background: var(--wrong-gray); color: #999; }
        .opt-box.correct { background: #eef7ff; color: #007bff; font-weight: bold; border-color: #007bff; }
        
        .result-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-top: 20px; text-align: center; }
        .result-score-box { background: #f8f9fa; padding: 20px; border-radius: 12px; margin: 20px 0; }
        .result-btns-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .action-btn { padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .btn-next-home { background: var(--cbt-blue); color: white; grid-column: span 2; margin-top: 5px; }

        .footer { position: fixed; bottom: 0; width: 100%; background: #f8f9fa; z-index: 100; border-top: 1px solid #ddd; }
        .footer-btns { display: flex; width: 100%; }
        .footer-btns button { flex: 1; padding: 18px; border: none; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        .prev-btn { background: #6c757d; color: white; border-right: 1px solid #5a6268 !important; }
        .next-btn { background: var(--cbt-blue); color: white; }
        .ad-banner { background: #eee; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: #777; }
        .check-btn { border: 1px solid #ccc; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.9rem; background: white; padding: 5px 12px; }
    </style>
</head>
<body>



<div id="screen-main">
    <div class="home-container">
        <h1 style="color: var(--cbt-dark); margin-top: 20px; font-size: 2rem;">ìš”ì–‘í•©ê²©</h1>

        <div class="section-title">ì‹¤ì „ ëª¨ì˜ê³ ì‚¬</div>
        <button class="menu-btn" onclick="toggleMenu('mock-menu')">ğŸ“ ê¸°ì¶œê¸°ë°˜ ì˜ˆìƒ ë¬¸ì œ (80ë¬¸ì œ) <span>â–¼</span></button>
        <div id="mock-menu" class="sub-menu">
            <button class="sub-btn" onclick="handleMockStart('ì œ1íšŒ ëª¨ì˜ê³ ì‚¬')">ì œ1íšŒ ëª¨ì˜ê³ ì‚¬</button>
            <button class="sub-btn" onclick="handleMockStart('ì œ2íšŒ ëª¨ì˜ê³ ì‚¬')">ì œ2íšŒ ëª¨ì˜ê³ ì‚¬</button>
            <button class="sub-btn" onclick="handleMockStart('ì œ3íšŒ ëª¨ì˜ê³ ì‚¬')">ì œ3íšŒ ëª¨ì˜ê³ ì‚¬</button>
            <button class="sub-btn" onclick="handleMockStart('ì œ4íšŒ ëª¨ì˜ê³ ì‚¬')">ì œ4íšŒ ëª¨ì˜ê³ ì‚¬</button>
            <button class="sub-btn" onclick="handleMockStart('ì œ5íšŒ ëª¨ì˜ê³ ì‚¬')">ì œ5íšŒ ëª¨ì˜ê³ ì‚¬</button>
            <button class="sub-btn" onclick="handleMockStart('ì œ6íšŒ ëª¨ì˜ê³ ì‚¬')">ì œ6íšŒ ëª¨ì˜ê³ ì‚¬</button>
            <button class="sub-btn" onclick="handleMockStart('ì œ7íšŒ ëª¨ì˜ê³ ì‚¬')">ì œ7íšŒ ëª¨ì˜ê³ ì‚¬</button>
            <button class="sub-btn" onclick="handleMockStart('ì œ8íšŒ ëª¨ì˜ê³ ì‚¬')">ì œ8íšŒ ëª¨ì˜ê³ ì‚¬</button>
            <div style="margin: 10px 0; border-top: 1px dashed #ccc;"></div>
            <button class="sub-btn" style="background:#fff3cd;" onclick="handleRandomMock('ëœë¤ ëª¨ì˜ê³ ì‚¬ 1')">ğŸ² ëœë¤ ëª¨ì˜ê³ ì‚¬ 1</button>
            <button class="sub-btn" style="background:#fff3cd;" onclick="handleRandomMock('ëœë¤ ëª¨ì˜ê³ ì‚¬ 2')">ğŸ² ëœë¤ ëª¨ì˜ê³ ì‚¬ 2</button>
            <button class="sub-btn" style="background:#fff3cd;" onclick="handleRandomMock('ëœë¤ ëª¨ì˜ê³ ì‚¬ 3')">ğŸ² ëœë¤ ëª¨ì˜ê³ ì‚¬ 3</button>
            <button class="sub-btn" style="background:#fff3cd;" onclick="handleRandomMock('ëœë¤ ëª¨ì˜ê³ ì‚¬ 4')">ğŸ² ëœë¤ ëª¨ì˜ê³ ì‚¬ 4</button>
            <button class="sub-btn" style="background:#fff3cd;" onclick="handleRandomMock('ëœë¤ ëª¨ì˜ê³ ì‚¬ 5')">ğŸ² ëœë¤ ëª¨ì˜ê³ ì‚¬ 5</button>
        </div>

        <div class="section-title">ê¸°ì¶œí•µì‹¬ ì‚´í´ë³´ê¸°</div>
        <button class="menu-btn" style="background:#fff3cd;" onclick="handleRandomShortQuiz(10)">
            ğŸ² ê¸°ì¶œí•µì‹¬ ëœë¤ 10ë¬¸ì œ <span>â–¶</span>
        </button>

        <div class="section-title">ê³¼ëª©ë³„ ì§‘ì¤‘ í•™ìŠµ</div>
        <button class="menu-btn" onclick="toggleMenu('subject-menu')">ğŸ“š ì˜ì—­ë³„ ë¬¸ì œ í’€ê¸° <span>â–¼</span></button>
        <div id="subject-menu" class="sub-menu">
        <button class="sub-btn" onclick="startQuiz('ìš”ì–‘ë³´í˜¸ë¡ ', 35)">ìš”ì–‘ë³´í˜¸ë¡  (í•„ê¸°)</button>
        <button class="sub-btn" onclick="startQuiz('ìš”ì–‘ë³´í˜¸ì‹¤ë¬´', 45)">ìš”ì–‘ë³´í˜¸ì‹¤ë¬´ (ì‹¤ê¸°)</button>
        </div>
        
        <div class="section-title">í•™ìŠµ ë„êµ¬</div>
        <button class="menu-btn" onclick="showChecked()">â­ ì²´í¬í•œ ë¬¸ì œ ë³µìŠµ</button>
        
        <div class="section-title">í•™ìŠµ ì°¸ê³  ìë£Œ</div>
      <!--  <button class="menu-btn" onclick="window.open('https://www.youtube.com/results?search_query=ìš”ì–‘ë³´í˜¸ì‚¬+ê°•ì˜')">ğŸ“º ìœ íŠœë¸Œ ìš”ì–‘ë³´í˜¸ ê°•ì˜ ë³´ê¸°</button> -->
        <button class="menu-btn" onclick="window.open('https://www.kuksiwon.or.kr/CBT_35/index.html#/')">ğŸ–¥ï¸ êµ­ì‹œì› CBT ì²´í—˜í•˜ê¸°</button>

		<div class="section-title">ë„ì›€ë§</div>
		<button class="menu-btn" style="background:#e9ecef; margin-bottom: 40px;" onclick="showManual()">
			ğŸ“– ìš”ì–‘í•©ê²© ì´ìš©ë°©ë²• <span>â–¶</span>
		</button>

		<div style="font-size: 0.75rem; color: #888; padding: 10px; border-top: 1px dashed #ccc;">
			ë³¸ ì•±ì˜ ì½˜í…ì¸ ëŠ” ìµœì‹  ê¸°ì¶œë¬¸ì œë¥¼ ë¶„ì„í•˜ì—¬ ì¬êµ¬ì„±í•œ ì˜ˆìƒ ë¬¸ì œì…ë‹ˆë‹¤. ì‹¤ì œ ì‹œí—˜ ë¬¸ì œì™€ ì™„ë²½íˆ ì¼ì¹˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë©°, ìµœì¢… ì •ë‹µì€ êµ­ì‹œì› ë°œí‘œë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤. ë³¸ ì•±ì€ í•™ìŠµì„ ë•ê¸° ìœ„í•œ ë³´ì¡° ë„êµ¬ë¡œ, ê²°ê³¼ì— ëŒ€í•œ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.
		</div>
    </div>
</div>

<div id="screen-quiz" style="display:none;">
    <div class="cbt-header">
        <div class="header-left">
            <div class="home-icon" onclick="saveAndExit()">
                <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            </div>
            <div class="font-controls">
                <button class="font-btn" onclick="adjustFont(-1)">-</button>
                <span>ê¸€ì</span>
                <button class="font-btn" onclick="adjustFont(1)">+</button>
            </div>
        </div>
        <div id="quiz-title" style="font-weight:bold;">ìš”ì–‘í•©ê²©</div>
        <div id="timer-display" style="color:#ffc107; font-weight:bold;">90:00</div>
    </div>
    
    <div class="progress-section">
        <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-weight:bold;">
            <span id="q-idx-text">ë¬¸ì œ 1</span><span id="progress-counts">0 / 80</span>
        </div>
        <div class="progress-container"><div id="bar" class="progress-bar"></div></div>
    </div>

    <div class="quiz-container">
        <div id="circle-mark"></div>
        <div id="q-content-area">
            <div class="q-info-row" style="display: flex; gap: 8px; align-items: center; margin-bottom: 15px;">
                <button id="check-btn" class="check-btn" onclick="toggleCheck()">âœ“ ì²´í¬</button>
                <button class="check-btn" style="background: #f8f9fa;" onclick="sendFeedback()">ğŸ’¡ ì˜ê²¬</button>
            </div>
            <div id="q-text" style="font-weight:bold; margin-bottom:20px; line-height:1.5;"></div>
            <div id="options-wrap"></div>
            <div id="hint-box" style="display:none; background:#fff9db; padding:15px; border-radius:8px; margin-top:15px; line-height:1.6;"></div>
        </div>

        <div id="result-area" style="display:none;">
            <div class="result-card">
                <h2 id="result-title">í•™ìŠµ ì™„ë£Œ</h2>
                <div class="result-score-box">
                    <div style="font-size:1.3rem; margin-bottom:10px;">ë§ì€ ê°œìˆ˜: <span id="res-correct" style="color:blue; font-weight:bold;">0</span></div>
                    <div style="font-size:1.1rem; color:#666;">ì•ˆ í‘¼ ë¬¸ì œ: <span id="res-unsolved">0</span></div>
                </div>
                <div class="result-btns-grid">
                    <button class="action-btn btn-next-home" onclick="location.reload()">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            </div>
        </div>
    </div>
    
    <div style="height:150px;"></div> 
    <div class="footer" id="quiz-footer">
        <div class="footer-btns">
            <button class="prev-btn" onclick="prevQuestion()">â—€ ì´ì „</button>
            <button class="next-btn" onclick="nextQuestion()">ë‹¤ìŒ â”</button>
        </div>
       
	   <div class="ad-banner">
			<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
				 style="display:inline-block;width:320px;height:50px"
				 data-ad-client="ca-app-pub-9626208165302787" 
				 data-ad-slot="6421874744"></ins> 
			<script>
				 (adsbygoogle = window.adsbygoogle || []).push({});
			</script>
		</div>  
    </div>
</div>


<script  src="./set01_38am.js"></script>
<script  src="./set02_38pm.js"></script>
<script  src="./set03_39am.js"></script>
<script  src="./set04_39pm.js"></script>
<script  src="./set05_40am.js"></script>
<script  src="./set06_40pm.js"></script>
<script  src="./set07_41am.js"></script>
<script  src="./set08_41pm.js"></script>
<script  >
    //import set01_38am from './set01_38am.json';
    // import set02_38pm from './set02_38pm.json';
    // import set03_39am from './set03_39am.json';
    // import set04_39pm from './set04_39pm.json';
    // import set05_40am from './set05_40am.json';
    // import set06_40pm from './set06_40pm.json';
    // import set07_41am from './set07_41am.json';
    // import set08_41pm from './set08_41pm.json';
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyBi52qaq34rtxK7QZCd2Sdh4esiD6NPVr9ikVEPmRp2UHbVps8jVbLh3RphWr5nFIa/exec";
    
    // console.dir(set01_38am);
        const allQuestions = [...set01_38am, ...set02_38pm, ...set03_39am, ...set04_39pm, ...set05_40am, ...set06_40pm , ...set07_41am , ...set08_41pm ];
    let quizList = [], currentIdx = 0, userAnswers = [], currentMode = "";
    let fontSizeLevel = 4, timerInterval, timeLeft = 90 * 60;
    let mockHistory = JSON.parse(localStorage.getItem('mockHistory')) || {};
    let checkedIds = JSON.parse(localStorage.getItem('checkedQuiz')) || [];

   // window.onload = updateMenuStatus;
	
	
	// í˜ì´ì§€ê°€ ì—´ë¦¬ìë§ˆì ì‹¤í–‰ë˜ëŠ” ë¶€ë¶„
	window.addEventListener('load', function() {
		if (typeof updateMenuStatus === 'function') updateMenuStatus();
		if (typeof adjustFont === 'function') adjustFont(0);
		// íŒì—… ê´€ë ¨ ë¡œì§ì€ í„°ì¹˜ ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.
	});

	// ë„ì›€ë§ ë²„íŠ¼ í´ë¦­ ì‹œ í•¨ìˆ˜ (íŒì—… ëŒ€ì‹  ë©”ì‹œì§€ì°½ ì‚¬ìš©)
	function showManual() {
		alert("ğŸ“– ìš”ì–‘í•©ê²© ì´ìš©ë°©ë²•\n\n1. ê¸€ì í¬ê¸°: ìƒë‹¨ +/- ë²„íŠ¼ìœ¼ë¡œ í¬ê²Œ í‚¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n2. ì •ë‹µ ê·¼ê±°: ë¬¸ì œ í’€ì´ í›„ ë…¸ë€ ë°•ìŠ¤ì—ì„œ í•´ì„¤ì„ í™•ì¸í•˜ì„¸ìš”.\n3. ì˜¤ë‹µ ë³µìŠµ: 80ë¬¸ì œë¥¼ ë‹¤ í’€ë©´ í‹€ë¦° ë¬¸ì œë§Œ ë‹¤ì‹œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
	}



    function toggleMenu(id) {
        const el = document.getElementById(id);
        const isVisible = (el.style.display === 'block');
        document.querySelectorAll('.sub-menu').forEach(m => m.style.display = 'none');
        el.style.display = isVisible ? 'none' : 'block';
    }

    function updateMenuStatus() {
        const types = ['ì œ1íšŒ ëª¨ì˜ê³ ì‚¬', 'ì œ2íšŒ ëª¨ì˜ê³ ì‚¬', 'ì œ3íšŒ ëª¨ì˜ê³ ì‚¬', 'ì œ4íšŒ ëª¨ì˜ê³ ì‚¬', 'ì œ5íšŒ ëª¨ì˜ê³ ì‚¬', 'ì œ6íšŒ ëª¨ì˜ê³ ì‚¬', 'ì œ7íšŒ ëª¨ì˜ê³ ì‚¬', 'ì œ8íšŒ ëª¨ì˜ê³ ì‚¬'];
        types.forEach((m, idx) => {
            const btn = document.querySelector(`button[onclick*="'${m}'"]`);
            if(!btn) return;
            const status = mockHistory[m];
            if(status) {
                if(status.completed) {
                    btn.style.background = "#bdc3c7";
                    btn.innerHTML += " <span>(ì™„ë£Œ)</span>";
                }
            }
        });
    }

    // ì¶”ê°€ëœ í•¨ìˆ˜: ì „ì²´ ë¬¸ì œ ì¤‘ ëœë¤ìœ¼ë¡œ 10ê°œë¥¼ ê³¨ë¼ì£¼ëŠ” ë¡œì§
    function handleRandomShortQuiz(count) {
        currentMode = "ê¸°ì¶œí•µì‹¬ 10ë¬¸ì œ";
        // ì „ì²´ ë¬¸ì œ(allQuestions)ë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ìŒ
        let shuffled = [...allQuestions].sort(() => Math.random() - 0.5);
        // ê·¸ì¤‘ ì•ì˜ 10ê°œë§Œ ì¶”ì¶œ
        quizList = shuffled.slice(0, count);
        userAnswers = new Array(quizList.length).fill().map(() => ({ selected: null, wrongAttempts: [] }));
        currentIdx = 0;
        initQuizScreen(); 
    }

    function handleMockStart(mode) {
        currentMode = mode;
		
		let filtered = allQuestions.filter(q => q.cat === mode);
		
		// **[ì¶”ê°€] í•´ë‹¹ íšŒì°¨ ë¬¸ì œë“¤ì„ ë¬´ì‘ìœ„ë¡œ ì„ìŠµë‹ˆë‹¤.**
		filtered.sort(() => Math.random() - 0.5);
			
        if(mockHistory[mode] && !mockHistory[mode].completed) {
            if(confirm("ì´ì „ì— í’€ë˜ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤. ì´ì–´ì„œ í‘¸ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                resumeQuiz(mode);
                return;
            }
        }
        // startQuiz(mode, 80);
		
		quizList = filtered.slice(0, 80);
		userAnswers = new Array(quizList.length).fill().map(() => ({ selected: null, wrongAttempts: [] }));
		currentIdx = 0;
		initQuizScreen();
    }

    function handleRandomMock(modeName) {
        currentMode = modeName;
        let shuffled = [...allQuestions].sort(() => Math.random() - 0.5);
        quizList = shuffled.slice(0, 80);
        userAnswers = new Array(quizList.length).fill().map(() => ({ selected: null, wrongAttempts: [] }));
        currentIdx = 0;
        initQuizScreen();
    }

    function startQuiz(mode, count) {
        currentMode = mode;
        let filtered = allQuestions.filter(q => q.sub.includes(mode)); // sub í•„ë“œ ê¸°ì¤€ ê²€ìƒ‰
		if(filtered.length === 0) filtered = [...allQuestions]; 
		
		// **[ì¶”ê°€] ì˜ì—­ë³„ ë¬¸ì œë„ ë¬´ì‘ìœ„ë¡œ ì„ìŠµë‹ˆë‹¤.**
		filtered.sort(() => Math.random() - 0.5);
		
		quizList = filtered.slice(0, count);
		userAnswers = new Array(quizList.length).fill().map(() => ({ selected: null, wrongAttempts: [] }));
		currentIdx = 0;
		initQuizScreen();
	}

    function resumeQuiz(mode) {
        const history = mockHistory[mode];
        quizList = history.quizList;
        userAnswers = history.userAnswers;
        currentIdx = history.lastIdx;
        initQuizScreen();
    }

    function initQuizScreen() {
        document.getElementById('screen-main').style.display = 'none';
        document.getElementById('screen-quiz').style.display = 'block';
        document.getElementById('quiz-title').innerText = currentMode;
        startTimer();
        loadQuestion();
    }

    function startTimer() {
        if(timerInterval) clearInterval(timerInterval);
        timeLeft = 90 * 60;
        timerInterval = setInterval(() => {
            timeLeft--;
            const mins = Math.floor(timeLeft / 60);
            const secs = timeLeft % 60;
            document.getElementById('timer-display').innerText = `${mins}:${secs < 10 ? '0'+secs : secs}`;
            if(timeLeft <= 0) finishSession();
        }, 1000);
    }

    function loadQuestion() {
        const q = quizList[currentIdx];
        const state = userAnswers[currentIdx];
        
		console.log("loadQuestion");
		console.dir(q);
				
        document.getElementById('circle-mark').style.display = 'none';
        document.getElementById('hint-box').style.display = 'none';
        document.getElementById('q-idx-text').innerText = `ë¬¸ì œ ${currentIdx + 1}`;
        document.getElementById('q-text').innerText = q.q;
        document.getElementById('progress-counts').innerText = `${currentIdx + 1} / ${quizList.length}`;
        document.getElementById('bar').style.width = ((currentIdx + 1) / quizList.length * 100) + "%";
        
        document.getElementById('check-btn').style.background = checkedIds.includes(q.id) ? "#ffeb3b" : "white";

        const wrap = document.getElementById('options-wrap');
        wrap.innerHTML = "";
        const nums = ["â‘ ", "â‘¡", "â‘¢", "â‘£", "â‘¤"];
        
        q.options.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'opt-box';
            btn.innerHTML = `<b>${nums[i]}</b> ${opt}`;
            
			console.log("a selected:", state.selected);
			console.log("a answer:", q.answer);
			console.log("a i     :", i);
			
            if(state.selected === q.answer) {				
                if(i === (q.answer-1)) btn.classList.add('correct');
                document.getElementById('circle-mark').style.display = 'block';
                document.getElementById('hint-box').style.display = 'block';
                document.getElementById('hint-box').innerHTML = `<b>ğŸ“‘ ì •ë‹µ ê·¼ê±°:</b><br>${q.note}`;
            } else if(state.wrongAttempts.includes(i)) {
                btn.classList.add('wrong');
            }

            btn.onclick = () => {
		
				// increase i +=1 (ì…ë ¥ì€ 0~4, ì •ë‹µì€ 1~5)
				console.log("selected:", state.selected);
				console.log("answer:", q.answer);
				console.log("i     :", i);
							
                if(state.selected !== q.answer) {
                    if(i === (q.answer-1)) {
                        state.selected = i+1;
                        loadQuestion();
                    } else {
                        if(!state.wrongAttempts.includes(i)) {
                            state.wrongAttempts.push(i);
                            btn.classList.add('wrong');
                        }
                    }
                }
            };
            wrap.appendChild(btn);
        });
        window.scrollTo(0,0);
    }

    function sendFeedback() {
        const qNum = currentIdx + 1;
        const comment = prompt(`ë¬¸ì œ ${qNum}ë²ˆì— ëŒ€í•œ ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.`);
        if (comment && comment.trim() !== "") {
            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ questionNum: qNum + "ë²ˆ", comment: comment })
            })
            .then(() => { alert("ì†Œì¤‘í•œ ì˜ê²¬ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤."); })
            .catch(error => { alert("ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); });
        }
    }

    function toggleCheck() {
        const q = quizList[currentIdx];
        if (checkedIds.includes(q.id)) { checkedIds = checkedIds.filter(id => id !== q.id); }
        else { checkedIds.push(q.id); }
        localStorage.setItem('checkedQuiz', JSON.stringify(checkedIds));
        document.getElementById('check-btn').style.background = checkedIds.includes(q.id) ? "#ffeb3b" : "white";
    }

    function showChecked() {
        const filtered = allQuestions.filter(q => checkedIds.includes(q.id));
        if(filtered.length === 0) return alert("ì²´í¬ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.");
        quizList = filtered;
        userAnswers = new Array(quizList.length).fill().map(() => ({ selected: null, wrongAttempts: [] }));
        currentIdx = 0;
        currentMode = "ì²´í¬ ë¬¸ì œ ë³µìŠµ";
        initQuizScreen();
    }

    function nextQuestion() {
        if (currentIdx < quizList.length - 1) { currentIdx++; loadQuestion(); }
        else finishSession();
    }

    function prevQuestion() {
        if (currentIdx > 0) { currentIdx--; loadQuestion(); }
    }

    function saveAndExit() {
        if(currentMode.includes('ëª¨ì˜ê³ ì‚¬') || currentMode.includes('í•µì‹¬') || currentMode.includes('ì˜ì—­')) {
            mockHistory[currentMode] = { quizList: quizList, userAnswers: userAnswers, lastIdx: currentIdx, completed: false };
            localStorage.setItem('mockHistory', JSON.stringify(mockHistory));
        }
        location.reload();
    }

	function finishSession() {
		clearInterval(timerInterval);
		
		// 1. ì˜¤ë‹µ í•„í„°ë§
		const wrongQuestions = quizList.filter((q, i) => userAnswers[i].wrongAttempts.length > 0);

		// 2. í™”ë©´ ì „í™˜ (ë¨¼ì € ê²°ê³¼ ì˜ì—­ì„ ë³´ì—¬ì¤Œ)
		document.getElementById('q-content-area').style.display = 'none';
		document.getElementById('quiz-footer').style.display = 'none';
		document.getElementById('result-area').style.display = 'block';

		// 3. íŒì—… ëŒ€ì‹  í™”ë©´ì— ì•ˆë‚´ ë¬¸êµ¬ì™€ ê´‘ê³  ì‹¤í–‰
		const resultArea = document.getElementById('result-area');
		resultArea.innerHTML = `
			<div class="result-card" style="padding: 40px 20px;">
				<h2 style="color: var(--cbt-dark);">í•™ìŠµ ê²°ê³¼ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</h2>
				<p style="font-size: 1.2rem; line-height: 1.6; margin: 20px 0;">
					**ì ì‹œ í›„ í‹€ë¦° ë¬¸ì œë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**<br>
					ìƒë‹¨ì˜ **Xí‘œ**ë¥¼ ëˆ„ë¥´ë©´ ê´‘ê³ ê°€ ë‹«íˆê³  ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.
				</p>
				<div style="margin-top: 30px; color: #666;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...</div>
			</div>
		`;

		// 4. ê´‘ê³  ì‹¤í–‰ (ì•ˆë“œë¡œì´ë“œ)
		if (window.Android) {
			window.Android.showScoreWithAd();
		}

		// 5. ê´‘ê³ ê°€ ë‹«íŒ ê²ƒìœ¼ë¡œ ê°€ì •í•˜ê±°ë‚˜ ì¼ì • ì‹œê°„ í›„ ì˜¤ë‹µ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
		// ì‹¤ì œë¡œëŠ” ì•ˆë“œë¡œì´ë“œì—ì„œ ê´‘ê³ ê°€ ë‹«í ë•Œ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì£¼ëŠ” ê²ƒì´ ê°€ì¥ ì •í™•í•©ë‹ˆë‹¤.
		setTimeout(() => {
			displayWrongAnswers(wrongQuestions);
		}, 3000); // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ 3ì´ˆ í›„ ì¶œë ¥ (ê´‘ê³  ë…¸ì¶œ ì‹œê°„ ê³ ë ¤)
	} 

	function displayWrongAnswers(wrongQuestions) {
		const resultArea = document.getElementById('result-area');
		let html = `
			<div class="result-card">
				<h2 style="color: #d32f2f;">í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ ë³´ê¸°</h2>
				<p style="margin-bottom: 20px;">í•œ ë²ˆì— ë§ì¶”ì§€ ëª»í•œ ë¬¸ì œì…ë‹ˆë‹¤.</p>
				<div id="wrong-list" style="text-align: left; max-height: 400px; overflow-y: auto; border-top: 1px solid #eee; padding-top: 15px;">
		`;

		if (wrongQuestions.length === 0) {
			html += `<div style="text-align:center; padding: 20px;">ëª¨ë“  ë¬¸ì œë¥¼ í•œ ë²ˆì— ë§ì¶”ì…¨ìŠµë‹ˆë‹¤!</div>`;
		} else {
			wrongQuestions.forEach((q) => {
				html += `
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid #ff5252;">
						<div style="font-weight: bold; margin-bottom: 5px;">[ë¬¸ì œ] ${q.q}</div>
						<div style="color: #007bff; font-weight: bold;">ì •ë‹µ: ${q.options[q.answer]}</div>
						<div style="font-size: 0.95rem; color: #666; margin-top: 5px; background: #fff; padding: 10px; border-radius: 5px;">
							<b>ğŸ“‘ ì •ë‹µ ê·¼ê±°:</b><br>${q.note}
						</div>
					</div>
				`;
			});
		}

		html += `
				</div>
				<div class="result-btns-grid" style="margin-top: 20px;">
					
					<button class="action-btn" style="background: var(--cbt-blue); color: white;" onclick="location.reload()">í™ˆìœ¼ë¡œ</button>
				</div>
			</div>
		`;

		resultArea.innerHTML = html;
	}

	function adjustFont(delta) {
		fontSizeLevel = Math.max(0, Math.min(6, fontSizeLevel + delta));
		const sizes = ["14px", "16px", "18px", "20px", "23px", "26px", "30px"];
		document.body.style.fontSize = sizes[fontSizeLevel];
	}
</script>
</body>
</html>